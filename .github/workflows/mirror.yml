name: Mirror

on: [push]

jobs:
  build:
    name: Mirror to SourceForge
    runs-on: ubuntu-latest
    steps:
    - name: GitHub Repo clone
      uses: actions/checkout@v1
    - name: Checkout master branch
      run: git checkout master
    - name: Prepare askpass script
      run: |
        echo "echo \"\$SSH_PASSWORD\"" > $HOME/askpass.sh
        chmod +x $HOME/askpass.sh
    - name: Mirror to SourceForge
      run: |
          export GIT_ASKPASS=$HOME/askpass.sh
          git remote set-url --push origin $OWSFPROTO$OWSFUSER@$OWSFHOST/p/$OWSFREPO
          git push -v
      env:
        SSH_PASSWORD: ${{ secrets.OW_SF_TOKEN2 }}
        OWSFUSER:     ${{ secrets.OW_SF_TOKEN1 }}
        OWSFPROTO:    https://
        OWSFHOST:     git.code.sf.net
        OWSFREPO:     openwatcom/open-watcom-v2-test-jm
