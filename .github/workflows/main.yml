name: Mirror

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: mirror to SourceForge
      run: |
          cd $GITHUB_WORKSPACE
          export GIT_ASKPASS=ci/askpass.sh
          export SSH_PASSWORD=$OW_SF_TOKEN2
          git checkout master
          git remote set-url --push origin $OWSFPROTO$OWSFUSER@$OWSFHOST/p/$OWSFREPO
          git push -v
      env:
        OW_SF_TOKEN2: ${{ secrets.OW_SF_TOKEN2 }}
        OWSFUSER: ${{ secrets.OW_SF_TOKEN1 }}
        OWSFPROTO: https://
        OWSFHOST: git.code.sf.net
        OWSFREPO: openwatcom/open-watcom-v2-test
