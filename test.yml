resources:
  repositories:
  - repository: wiki
    type: GitHub
    name: open-watcom/open-watcom-v2-webdocs
    endpoint: open-watcom-v2-wikidocs

jobs:
  - job: wikiupd
    displayName: "Wiki Documentation Update"
    continueOnError: true
    variables:
      owroot:        $(Build.SourcesDirectory)
      owwiki_depth:  10
      owwikiproject: open-watcom/open-watcom-v2-webdocs
      owwikiroot:    $(Pipeline.Workspace)/wiki
      ssh.password:  $(owghtoken2)
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - template: ci/gituser.yml
    - script: |
        export SSH_ASKPASS=$(owroot)/ci/askpass.sh
        git clone --depth=1 --branch=master https://$(owghtoken1)@github.com/$(owwikiproject).git $(owwikiroot)
        cd $(owwikiroot)
        git add -v -f .
        git status -uno --porcelain
        if [ -n "$(git status -uno --porcelain)x" ]
        then
          git commit -v -m "Azure Pipelines build $(Build.BuildNumber)"
          git push -v
        fi
        pwd
      displayName: "Wiki Docs update"
